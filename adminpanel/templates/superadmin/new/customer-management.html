{% extends 'superadmin/new/new-base.html' %}
{% block body %}
<div class="WrapperArea">
    <div class="WrapperBox">
        <div class="content-wrapper">
            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-danger alert-dismissible fade in" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            {% endfor %}
            {% endif %}
        </div>
        <div class="Small-Wrapper">
            <h4 class="Title">Organization Management
                <a href="JavaScript:Void(0);" data-toggle="modal" data-target="#AddModal"> New Organization </a>
            </h4>
            <div class="FilterArea">
                <form method="get">
                    <div class="form-group">
                        <label>Organization Name</label>
                        <input type="text" class="form-control" placeholder="Enter Organization Name"
                               name="organization_name" required>
                    </div>
                    <div class="form-group">
                        <label>Person Name</label>
                        <input type="text" class="form-control" placeholder="Enter Person Name" name="first_name"
                               required>
                    </div>
                    <div class="form-group">
                        <label>Email ID</label>
                        <input type="text" class="form-control" placeholder="Enter Email ID" name="email" required>
                    </div>
                    <div class="form-group">
                        <label>Mobile Number</label>
                        <input type="text" class="form-control" placeholder="Enter Mobile Number" required>
                    </div>
                    <div class="form-group">
                        <label>Client Code</label>
                        <input type="text" class="form-control" placeholder="Enter Client  Code" name="client_code"
                               required>
                    </div>
                    <div class="form-group">
                        <label>Registered From</label>
                        <input type="date" class="form-control" placeholder="Enter Name" name="from_date" required>
                    </div>
                    <div class="form-group">
                        <label>Registered To</label>
                        <input type="date" class="form-control" placeholder="Enter Name" name="to_date" required>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="Button Reset" type="reset"><i class="fa fa-refresh"></i></button>
                        <button class="Button" type="submit">Apply</button>
                    </div>
                </form>
            </div>
            {% if no_data %}
            <div class="TableList">
                <div class="CountExportArea">
                    <a href="" class="Export"><i class="fa fa-file-excel-o"></i> Export </a>
                    <label>
                        Show per page
                        <select>
                            <option>5</option>
                            <option>10</option>
                            <option>20</option>
                            <option>50</option>
                            <option>100</option>
                        </select>
                    </label>
                </div>

                <div class="CustomerTable">
                    <table style="width: 125%">
                        <thead>
                        <tr>
                            <th>S.No</th>
                            <th>Organization Name</th>
                            <th>User Name</th>
                            <th>Email ID</th>
                            <th>Mobile Number</th>
                            <th>Client Code</th>
                            <th>Registered On</th>
                            <th>Recurring</th>
                            <th>Subscription Status</th>
                            <th>action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td align="center" colspan="10">
                                <h1>
                                    <center>Sorry, No data found</center>
                                </h1>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            {% elif filter %}
            <div class="TableList">
                <div class="CountExportArea">
                    <a href="" class="Export"><i class="fa fa-file-excel-o"></i> Export </a>
                    <label>
                        Show per page
                        <select>
                            <option>5</option>
                            <option>10</option>
                            <option>20</option>
                            <option>50</option>
                            <option>100</option>
                        </select>
                    </label>
                </div>

                <div class="CustomerTable">
                    <table style="width: 125%">
                        <thead>
                        <tr>
                            <th>S.No</th>
                            <th>Organization Name</th>
                            <th>User Name</th>
                            <th>Email ID</th>
                            <th>Mobile Number</th>
                            <th>Client Code</th>
                            <th>Registered On</th>
                            <th>Recurring</th>
                            <th>Subscription Status</th>
                            <th>action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for object in filter %}
                        <tr>
                            <td>{{forloop.counter}}</td>
                            <td>{{object.organization_name.organization_name}}</td>
                            <td>{{object.organization_name.first_name}} {{object.organization_name.last_name}}</td>
                            <td>{{object.organization_name.email}}</td>
                            <td>{{object.organization_name.mobile_number}}</td>
                            <td>{{object.organization_name.client_code}}</td>
                            <td>{{object.organization_name.created_at}}</td>
                            <td>Yes</td>
                            <td>
                                {% if object.active %}
                                <span class="green">Active</span>
                                {% else %}
                                <span class="red">InActive</span>
                                {% endif %}

                            </td>
                            <td>
                                <div class="Actions">
                                    <label class="Switch">
                                        <input type="checkbox" checked/>
                                        <span class="slider"></span>
                                    </label>

                                    <button class="Green organizationEdit"
                                            data-toggle="modal"
                                            data-target="#EditModal" id="{{object.organization_name.id}}"
                                            value="{{object.organization_name.id}}">
                                        <i class="fa fa-pencil-square-o"
                                           onclick="editValue({{object.organization_name.id}})"></i>
                                    </button>

                                    <a class="Red" href="JavaScript:Void(0);" data-toggle="modal"
                                       data-target="#DeleteModal">
                                        <i class="fa fa-trash"></i>
                                    </a>

                                    <a class="Blue" href="JavaScript:Void(0);" data-toggle="modal"
                                       data-target="#PasswordModal">
                                        <i class="fa fa-unlock-alt"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% elif pages %}
            <div class="TableList">
                <div class="CountExportArea">
                    <a href="" class="Export"><i class="fa fa-file-excel-o"></i> Export </a>
                    <label>
                        Show per page
                        <select>
                            <option>5</option>
                            <option>10</option>
                            <option>20</option>
                            <option>50</option>
                            <option>100</option>
                        </select>
                    </label>
                </div>
                <div class="CustomerTable">
                    <table style="width: 125%">
                        <thead>
                        <tr>
                            <th>S.No</th>
                            <th>Organization Name</th>
                            <th>User Name</th>
                            <th>Email ID</th>
                            <th>Mobile Number</th>
                            <th>Client Code</th>
                            <th>Registered On</th>
                            <th>Recurring</th>
                            <th>Subscription Status</th>
                            <th>action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for object in pages %}
                        <tr>
                            <td>{{forloop.counter}}</td>
                            <td>{{object.organization_name.organization_name}}</td>
                            <td>{{object.organization_name.first_name}} {{object.organization_name.last_name}}</td>
                            <td>{{object.organization_name.email}}</td>
                            <td>{{object.organization_name.mobile_number}}</td>
                            <td>{{object.organization_name.client_code}}</td>
                            <td>{{object.organization_name.created_at}}</td>
                            <td>Yes</td>
                            <td>
                                {% if object.active %}
                                <span class="green">Active</span>
                                {% else %}
                                <span class="red">InActive</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="Actions">
                                    <label class="Switch">
                                        <input type="checkbox" checked/>
                                        <span class="slider"></span>
                                    </label>
                                    <button class="Green organizationEdit"
                                            data-toggle="modal"
                                            data-target="#EditModal" id="{{object.organization_name.id}}"
                                            value="{{object.organization_name.id}}">
                                        <i class="fa fa-pencil-square-o"
                                           onclick="editValue({{object.organization_name.id}})"></i>
                                    </button>
                                    <a class="Red" href="JavaScript:Void(0);" data-toggle="modal"
                                       data-target="#DeleteModal">
                                        <i class="fa fa-trash"></i>
                                    </a>
                                    <a class="Blue" href="JavaScript:Void(0);" data-toggle="modal"
                                       data-target="#PasswordModal">
                                        <i class="fa fa-unlock-alt"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% else %}
            <div class="TableList">
                <div class="CountExportArea">
                    <a href="" class="Export"><i class="fa fa-file-excel-o"></i> Export </a>
                    <label>
                        Show per page
                        <select>
                            <option>5</option>
                            <option>10</option>
                            <option>20</option>
                            <option>50</option>
                            <option>100</option>
                        </select>
                    </label>
                </div>
                <div class="CustomerTable">
                    <table style="width: 125%">
                        <thead>
                        <tr>
                            <th>S.No</th>
                            <th>Organization Name</th>
                            <th>User Name</th>
                            <th>Email ID</th>
                            <th>Mobile Number</th>
                            <th>Client Code</th>
                            <th>Registered On</th>
                            <th>Recurring</th>
                            <th>Subscription Status</th>
                            <th>action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for object in object_list %}
                        <tr>
                            <td>{{forloop.counter}}</td>
                            <td>{{object.organization_name.organization_name}}</td>
                            <td>{{object.organization_name.first_name}} {{object.organization_name.last_name}}</td>
                            <td>{{object.organization_name.email}}</td>
                            <td>{{object.organization_name.mobile_number}}</td>
                            <td>{{object.organization_name.client_code}}</td>
                            <td>{{object.organization_name.created_at}}</td>
                            <td>Yes</td>
                            <td>
                                {% if object.active %}
                                <span class="green">Active</span>
                                {% else %}
                                <span class="red">InActive</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="Actions">
                                    <label class="Switch">
                                        <input type="checkbox" checked/>
                                        <span class="slider"></span>
                                    </label>
                                    <button class="Green organizationEdit"
                                            data-toggle="modal"
                                            data-target="#EditModal" id="{{object.organization_name.id}}"
                                            value="{{object.organization_name.id}}">
                                        <i class="fa fa-pencil-square-o"
                                           onclick="editValue({{object.organization_name.id}})"></i>
                                    </button>
                                    <a class="Red" href="JavaScript:Void(0);" data-toggle="modal"
                                       data-target="#DeleteModal">
                                        <i class="fa fa-trash"></i>
                                    </a>
                                    <a class="Blue" href="JavaScript:Void(0);" data-toggle="modal"
                                       data-target="#PasswordModal">
                                        <i class="fa fa-unlock-alt"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            <!--            <div class="Pagination">-->
            <!--                <ul>-->
            <!--                    <li><a href="#">Previous</a></li>-->
            <!--                    <li class="active"><a href="#">1</a></li>-->
            <!--                    <li><a href="#">2</a></li>-->
            <!--                    <li><a href="#">3</a></li>-->
            <!--                    <li><a href="#">Next</a></li>-->
            <!--                </ul>-->
            <!--            </div>-->
            {% if pages.has_other_pages %}
            <ul class="Pagination">
                {% if pages.has_previous %}
                <li class="page-item"><a aria-label="Previous" class="page-link"
                                         href="?page={{ pages.previous_page_number }}">Previous</a></li>
                {% else %}
                <li class="page-item disabled"><span>&laquo;</span></li>
                {% endif %}
                {% for i in pages.paginator.page_range %}
                {% if pages.number == i %}
                <li class="page-item active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
                {% else %}
                <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                {% endif %}
                {% endfor %}
                {% if pages.has_next %}
                <li class="page-item"><a aria-label="Next" class="page-link" href="?page={{ pages.next_page_number }}">Next</a>
                </li>
                {% else %}
                <li class="page-item disabled"><span>&raquo;</span></li>
                {% endif %}
            </ul>
            {% endif %}


            <!--            {% if is_paginated %}-->
            <!--            <ul class="pagination">-->
            <!--                {% if page_obj.has_previous %}-->
            <!--                <li><a href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>-->
            <!--                {% else %}-->
            <!--                <li class="disabled"><span>&laquo;</span></li>-->
            <!--                {% endif %}-->
            <!--                {% for i in paginator.page_range %}-->
            <!--                {% if page_obj.number == i %}-->
            <!--                <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>-->
            <!--                {% else %}-->
            <!--                <li><a href="?page={{ i }}">{{ i }}</a></li>-->
            <!--                {% endif %}-->
            <!--                {% endfor %}-->
            <!--                {% if page_obj.has_next %}-->
            <!--                <li><a href="?page={{ page_obj.next_page_number }}">&raquo;</a></li>-->
            <!--                {% else %}-->
            <!--                <li class="disabled"><span>&raquo;</span></li>-->
            <!--                {% endif %}-->
            <!--            </ul>-->
            <!--            {% endif %}-->
        </div>

    </div>
</div>

<div class="ModalBox">

    <div class="modal" id="DeleteModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="Decline">
                        <a href="JavaScript:Void(0);" data-dismiss="modal" class="CloseModal">×</a>
                        <h3>Delete</h3>
                        <p>Are you sure you want to delete this Organization ?</p>
                        <h4>
                            <a href="JavaScript:Void(0);" data-dismiss="modal">No</a>
                            <a href="JavaScript:Void(0);" data-dismiss="modal">Yes</a>
                        </h4>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="ActiveModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="Decline">
                        <a href="JavaScript:Void(0);" data-dismiss="modal" class="CloseModal">×</a>
                        <h3>Active</h3>
                        <p>Are you sure you want to active this Organization ?</p>
                        <h4>
                            <a href="JavaScript:Void(0);" data-dismiss="modal">No</a>
                            <a href="JavaScript:Void(0);" data-dismiss="modal">Yes</a>
                        </h4>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="InactiveModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="Decline">
                        <a href="JavaScript:Void(0);" data-dismiss="modal" class="CloseModal">×</a>
                        <h3>Inactive</h3>
                        <p>Are you sure you want to inactive this Organization ?</p>
                        <h4>
                            <a href="JavaScript:Void(0);" data-dismiss="modal">No</a>
                            <a href="JavaScript:Void(0);" data-dismiss="modal">Yes</a>
                        </h4>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="modal" id="EditModal">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-body">
                    <div class="Category">
                        <a href="javascript:void(0);" class="CloseModal" data-dismiss="modal">&times;</a>
                        <h3>Edit Organization </h3>
                        <div class="content-wrapper" id="editerror">

                        </div>
                        <form method="post">
                            {% csrf_token %}
                            <div id="object_id_placeholder_div">
                                <input hidden="true" id="object_id_placeholder_input" value="">
                            </div>
                            <div class="form-group">
                                <label>Organization Name</label>
                                <input type="text" class="form-control" placeholder="Enter Organization Name"
                                       name="organization_name" required id="edit_organization_name"
                                       value="">
                            </div>

                            <div class="form-group">
                                <label>Person First Name <sup>*</sup> </label>
                                <input type="text" class="form-control" placeholder="Enter First Name" value=""
                                       name="first_name" id="edit_first_name" required>
                            </div>

                            <div class="form-group">
                                <label>Person Last Name <sup>*</sup> </label>
                                <input type="text" class="form-control" placeholder="Enter Last Name" value=""
                                       name="last_name" required id="edit_last_name">
                            </div>

                            <div class="form-group">
                                <label>Email ID <sup>*</sup> </label>
                                <input type="text" class="form-control" placeholder="Enter Email Address"
                                       value="" required name="email" id="edit_email">
                            </div>

                            <div class="form-group">
                                <label>Mobile Number <sup>*</sup> </label>
                                <input type="text" class="form-control" placeholder="Enter Mobile Number"
                                       value="" name="mobile_number" required id="edit_mobile_number">
                            </div>
                        </form>

                        <!--                            <div class="form-group">-->
                        <!--                                <label class="CheckBox">Make Inactive-->
                        <!--                                    <input type="checkbox">-->
                        <!--                                    <span class="checkmark"></span>-->
                        <!--                                </label>-->
                        <!--                            </div>-->

                        <button class="Button" type="button" onclick="editOrganization()">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="PasswordModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="Category">
                        <a href="javascript:void(0);" class="CloseModal" data-dismiss="modal">&times;</a>
                        <h3>Organization Change Password </h3>

                        <div class="form-group">
                            <label>New Password</label>
                            <input type="password" class="form-control" placeholder="Enter Password">
                        </div>

                        <div class="form-group">
                            <label>Confirm Password </label>
                            <input type="password" class="form-control" placeholder="Enter Confirm Password">
                        </div>

                        <button class="Button">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="AddModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="Category">
                        <a href="javascript:void(0);" class="CloseModal" data-dismiss="modal">&times;</a>
                        <h3>Add New Organization </h3>
                        <div class="content-wrapper" id="error">
                            {% if messages %}
                            {% for message in messages %}
                            <div class="alert alert-danger alert-dismissible fade in" role="alert">
                                {{ message }}
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            {% endfor %}
                            {% endif %}
                        </div>
                        <form method="post">
                            {% csrf_token %}
                            <div class="form-group">
                                <label>Organization Name</label>
                                <input type="text" class="form-control" placeholder="Enter Organization Name"
                                       name="organization_name" id="organization_name" required>
                            </div>
                            <div class="form-group">
                                <label>Person First Name <sup>*</sup> </label>
                                <input type="text" class="form-control" placeholder="Enter First Name" name="first_name"
                                       id="first_name" required>
                            </div>
                            <div class="form-group">
                                <label>Person Last Name <sup>*</sup> </label>
                                <input type="text" class="form-control" placeholder="Enter Last Name" name="last_name"
                                       id="last_name" required>
                            </div>
                            <div class="form-group">
                                <label>Mobile Number <sup>*</sup> </label>
                                <input type="number" class="form-control" placeholder="Enter Mobile Number"
                                       name="mobile_number" id="mobile_number" required>
                            </div>
                            <div class="form-group">
                                <label>Email Id <sup>*</sup> </label>
                                <input type="email" class="form-control" placeholder="Enter Email Id" name="email"
                                       id="email" required>
                            </div>
                            <div class="form-group">
                                <label class="CheckBox">Make Inactive
                                    <input type="checkbox" name="active" id="active">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                        </form>
                        <button class="Button Cancel">Cancel</button>
                        <button class="Button" onclick="test()">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function test() {
    var organization_name = $('#organization_name').val();
    var first_name = $('#first_name').val();
    var last_name = $('#last_name').val();
    var mobile_number = $('#mobile_number').val();
    var email = $('#email').val();
    var password = $('#password').val();
    var check = document.getElementById("active").checked;

    var url = "{% url 'adminpanel:create-organization' %}"

    $.ajax({
        url : url,
        method : 'POST',
        data:{
        organization_name:organization_name,
        first_name:first_name,
        last_name:last_name,
        mobile_number : mobile_number,
        email : email,
        check : check,
        password : password,
        csrfmiddlewaretoken: "{{ csrf_token }}"
        },
        success: function(data){
           console.log('inside success',data)
            var protocol = window.location.protocol
            var hostname = window.location.hostname
            var port = window.location.port
            var url = protocol + "//" + hostname + ":" + port + "/adminpanel" + "/customer-management" + "/"
            //alert("remember_me", remember_me)
            window.location.href = url
        },
        error: function(data) {
           data = data.responseJSON.message;
           error = document.getElementById('error')
           console.log('error',error)
           error.innerHTML = `<div class="alert alert-warning alert-dismissible" role="alert">
                            ${data}
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>`;
           $(document).ready(function() {
           $('#signup2').modal('toggle');
           });
        }
    });
    event.preventDefault();
    }










</script>

<script>
function editValue(id){
   var x = '#' + id
   var value =  $('#' + id).val();
   $("#object_id_placeholder_div").html(`<input hidden="true" id="object_id_placeholder_input" value="` + value + `">`)
    console.log('value--->>',value)
   $('.CloseModal').click(function (e) {
        e.preventDefault();
//      $('.modal').removeClass('show');
    });
    sessionStorage.setItem('objId', id)
};

function editOrganization(){
    var edit_organization_name = $('#edit_organization_name').val();
    var edit_first_name = $('#edit_first_name').val();
    var edit_last_name = $('#edit_last_name').val();
    var edit_email = $('#edit_email').val();
    var edit_mobile_number = $('#edit_mobile_number').val();
<!--    var obj_id = $('#object_id_placeholder_input').val();-->
    var obj_id = sessionStorage.getItem('objId');
    console.log(obj_id)
    var url = '{% url 'adminpanel:edit-organization' %}'
      $.ajax({
        url: url,
        method : 'POST',
        data:{
            obj_id:obj_id,
            edit_organization_name:edit_organization_name,
            edit_first_name:edit_first_name,
            edit_last_name:edit_last_name,
            edit_email:edit_email,
            edit_mobile_number:edit_mobile_number,
            csrfmiddlewaretoken: "{{ csrf_token }}"
        },
      success: function(data){
        console.log('inside success',data)
            var protocol = window.location.protocol
            var hostname = window.location.hostname
            var port = window.location.port
            var url = protocol + "//" + hostname + ":" + port + "/adminpanel" + "/customer-management" + "/"
            sessionStorage.removeItem('objId')
            window.location.href = url

        },
      error: function(data){
      data = data.responseJSON.message;
           error = document.getElementById('editerror')
           console.log('error',error)
           error.innerHTML = `<div class="alert alert-warning alert-dismissible" role="alert">
                            ${data}
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>`;
           $(document).ready(function() {
           $('#signup2').modal('toggle');
           });

      },
      })
}







</script>
{% endblock body %}